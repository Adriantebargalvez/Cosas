<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Chat</title>
</head>
<body>
    <label for="nombre">Ingresa tu nombre:</label>
    <input type="text" id="nombre">
    <button onclick="conectar()">Conectar</button>


    <div id="chat" style="display: none;">
        <p id="datos">-</p>
        <ul id="listaUsuarios"></ul>
        <br>
        <label for="mensaje">Mensaje:</label>
        <input type="text" id="mensaje">
        <button onclick="Enviar()">Enviar</button> 
        
    </div>
   

    <script>
        let ws;
        let historialMensajes = [];
       
        function conectar() {
           
            const nombre = document.getElementById("nombre").value;
            if (nombre.trim()!=="") {
                document.getElementById("chat").style.display="block";

                ws = new WebSocket("ws://" + location.hostname +":443/");
                ws.nombre = nombre;
                ws.addEventListener("open",()=> {
                    console.log('Conectado como'+nombre);
                    ws.send(nombre);
                });

                ws.onmessage = (mensaje) => {
            console.log(mensaje);

            if (mensaje.data.startsWith("[") && mensaje.data.endsWith("]")) {
                        const listaUsuarios = JSON.parse(mensaje.data);
                        actualizarListaUsuarios(listaUsuarios);
                    } else {
                        historialMensajes.push(mensaje.data);
                        actualizarHistorialMensajes();
                    }
        };

                var mensajeInput = document.getElementById("mensaje");
                mensajeInput.focus();
                mensajeInput.onkeypress = function (e) {
                    if (e.key == "Enter") Enviar();
                };
            } else {
                alert("ingresa un nombre");
            }
        }

        function Enviar() {
            ws.send(mensaje.value);
            mensaje.value = "";
            mensaje.focus();
        }
        function actualizarHistorialMensajes() {
            const datosElemento = document.getElementById("datos");
            datosElemento.innerHTML = historialMensajes.join("<br>");
        }
        function actualizarListaUsuarios(listaUsuarios) {
            const listaUsuariosElemento = document.getElementById("listaUsuarios");
                listaUsuariosElemento.innerHTML = "";
                listaUsuarios.forEach(usuario => {
            const li = document.createElement("li");
                li.textContent = usuario;
                listaUsuariosElemento.appendChild(li);
    });
}

    </script>
    <label for="usuario">Chat privado con:</label>
    <input type="text" id="usuario">
    <button onclick="conectarPriv()">Privado</button>
    <script>
         function conectarPriv() {
           
} 
</script>

  


        
         
    </script>
</body>
</html>
